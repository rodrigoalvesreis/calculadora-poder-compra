<div class="container form border rounded p-3">
  <form [formGroup]="form" (ngSubmit)="calcular()">
    <div class="row">
      <div class="col-12 col-md-4">
        <div class="input-group">
          <span class="input-group-text bg-light text-muted">R$</span>
          <input type="text" class="form-control text-end" formControlName="valorImovel" appCurrencyMask
            [ngClass]="{'is-invalid': form.get('valorImovel')?.invalid && form.get('valorImovel')?.touched}"
            placeholder="Informe o valor do imóvel">
        </div>
        <div class="text-danger small" *ngIf="form.get('valorImovel')?.invalid && form.get('valorImovel')?.touched">
          <span *ngIf="form.get('valorImovel')?.errors?.['required']">Informe o valor do imóvel</span>
          <span *ngIf="form.get('valorImovel')?.errors?.['min']">O valor mínimo é R$ 100,00.</span>
        </div>
      </div>

      <div class="col-12 col-md-4">
        <div class="input-group">
          <span class="input-group-text bg-light text-muted">R$</span>
          <input type="text" class="form-control text-end" formControlName="saldoDevedor" appCurrencyMask
            [ngClass]="{'is-invalid': form.get('saldoDevedor')?.invalid && form.get('saldoDevedor')?.touched}"
            placeholder="Informe o saldo devedor">
        </div>
        <div class="text-danger small" *ngIf="form.get('saldoDevedor')?.invalid && form.get('saldoDevedor')?.touched">
          <span *ngIf="form.get('saldoDevedor')?.errors?.['required']">Informe o saldo devedor</span>
          <span *ngIf="form.get('saldoDevedor')?.errors?.['min']">O valor mínimo é R$ 100,00.</span>
        </div>
      </div>

      <div class="col-12 col-md-4">
        <div class="input-group">
          <span class="input-group-text bg-light text-muted">R$</span>
          <input type="text" class="form-control text-end" formControlName="valorRenda" appCurrencyMask
            [ngClass]="{'is-invalid': form.get('valorRenda')?.invalid && form.get('valorRenda')?.touched}"
            placeholder="Informe a Renda">
        </div>
        <div class="text-danger small" *ngIf="form.get('valorRenda')?.invalid && form.get('valorRenda')?.touched">
          <span *ngIf="form.get('valorRenda')?.errors?.['required']">Informe o saldo devedor</span>
          <span *ngIf="form.get('valorRenda')?.errors?.['min']">O valor mínimo é R$ 100,00.</span>
        </div>
      </div>
    </div>
    <div class="row pt-3">
      <div class="col-12 col-md-2 text-center text-md-start">
        <button type="submit" class="btn btn-primary">
          <i class="fa-solid fa-calculator"></i> Calcular
        </button>
      </div>
    </div>
  </form>
</div>

<div *ngIf="resultado" class="mt-5 animate__animated animate__fadeIn">

  <div class="row g-4">
    <div class="col-md-7">
      <div class="card border-0 shadow-sm h-100">
        <div class="card-body p-4">
          <h6 class="text-secondary text-uppercase fw-bold mb-4" style="letter-spacing: 1px;">Sua Capacidade de Crédito
          </h6>

          <div class="d-flex justify-content-between align-items-center mb-3 pb-3 border-bottom">
            <span class="text-muted fw-bold">Crédito Máximo (60% do Imóvel)</span>
            <span>{{ resultado.valorMaximoFinanciavel | currency:'BRL' }}</span>
          </div>

          <div class="d-flex justify-content-between align-items-center mb-3 pb-3 border-bottom">
            <span class="text-muted fw-bold">Prestação Mensal Estimada</span>
            <span>{{ resultado.prestacaoEstimada | currency:'BRL' }}</span>
          </div>

          <div class="d-flex justify-content-between align-items-center">
            <span class="text-muted fw-bold">Portabilidade</span>
            <span [class]="resultado.podePortarSaldoDevedor ? 'text-success fw-bold' : 'text-danger fw-bold'">
              <i
                [class]="resultado.podePortarSaldoDevedor ? 'fa-solid fa-check-circle' : 'fa-solid fa-circle-xmark'"></i>
              {{ resultado.podePortarSaldoDevedor ? 'Disponível' : 'Indisponível' }}
            </span>
          </div>
        </div>
      </div>
    </div>

    <div class="col-md-5">
      <div class="card border-0 bg-primary text-white shadow-sm h-100">
        <div class="card-body p-4">
          <h6 class="text-uppercase fw-bold mb-4" style="opacity: 0.8;">Condições da Simulação</h6>

          <div class="mb-4">
            <small class="d-block mb-1" style="opacity: 0.7;">Limite por Renda (30%)</small>
            <div class="h5 fw-bold">{{ resultado.prestacaoMaximaPermitida | currency:'BRL' }}</div>
          </div>

          <div class="row g-2">
            <div class="col-6">
              <small class="d-block mb-1" style="opacity: 0.7;">Taxa de Juros</small>
              <div class="fw-bold"> {{ resultado.taxaAplicadaAnual | percent:'1.2-4':'pt-BR' }} a.a</div>
            </div>
            <div class="col-6">
              <small class="d-block mb-1" style="opacity: 0.7;">Prazo Máximo</small>
              <div class="fw-bold">{{ resultado.prazoAplicadoAnos }} Anos</div>
            </div>
          </div>

          <hr style="opacity: 0.3;">

          <div *ngIf="resultado.prestacaoEstimada > resultado.prestacaoMaximaPermitida"
            class="mt-3 p-2 rounded bg-white text-danger small fw-bold">
            <i class="fa-solid fa-triangle-exclamation me-1"></i>
            Prestação acima do limite de 30% da renda.
            (Renda necessária: {{resultado.prestacaoEstimada / 0.3 | currency:'BRL' }})
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Observações -->
  <div class="container pt-5">


    <!-- Observação 1 -->
    <div class="alert alert-info d-flex align-items-center" role="alert" id="obs1">
      <i class="fa-solid fa-circle-question me-2"></i>
      <div class="text-start m-3">Simulação baseada nas regras vigentes de Crédito com Garantia de Imóvel.<br>
        Comprometimento de renda máximo de 30% e financiamento limitado a 60% do valor do imóvel.
      </div>
    </div>

  </div>
</div>