<div class="container form border rounded p-3">
  <form [formGroup]="form" (ngSubmit)="calcular()" >
    <div class="row">
      <div class="col-12 col-md-4">
        <div class="input-group">
          <span class="input-group-text bg-light text-muted">R$</span>
          <input type="text" class="form-control text-end" formControlName="valorImovel" appCurrencyMask
            [ngClass]="{'is-invalid': form.get('valorImovel')?.invalid && form.get('valorImovel')?.touched}"
            placeholder="Informe o valor do imóvel">
        </div>
        <div class="text-danger small" *ngIf="form.get('valorImovel')?.invalid && form.get('valorImovel')?.touched">
          <span *ngIf="form.get('valorImovel')?.errors?.['required']">Informe o valor do imóvel</span>
          <span *ngIf="form.get('valorImovel')?.errors?.['min']">O valor mínimo é R$ 100,00.</span>
        </div>
      </div>

      <div class="col-12 col-md-4">
        <div class="input-group">
          <span class="input-group-text bg-light text-muted">R$</span>
          <input type="text" class="form-control text-end" formControlName="saldoDevedor" appCurrencyMask
            [ngClass]="{'is-invalid': form.get('saldoDevedor')?.invalid && form.get('saldoDevedor')?.touched}"
            placeholder="Informe o saldo devedor">
        </div>
        <div class="text-danger small" *ngIf="form.get('saldoDevedor')?.invalid && form.get('saldoDevedor')?.touched">
          <span *ngIf="form.get('saldoDevedor')?.errors?.['required']">Informe o saldo devedor</span>
          <span *ngIf="form.get('saldoDevedor')?.errors?.['min']">O valor mínimo é R$ 100,00.</span>
        </div>
      </div>

      <div class="col-12 col-md-4">
        <div class="input-group">
          <span class="input-group-text bg-light text-muted">R$</span>
          <input type="text" class="form-control text-end" formControlName="valorRenda" appCurrencyMask
            [ngClass]="{'is-invalid': form.get('valorRenda')?.invalid && form.get('valorRenda')?.touched}"
            placeholder="Informe a Renda">
        </div>
        <div class="text-danger small" *ngIf="form.get('valorRenda')?.invalid && form.get('valorRenda')?.touched">
          <span *ngIf="form.get('valorRenda')?.errors?.['required']">Informe o saldo devedor</span>
          <span *ngIf="form.get('valorRenda')?.errors?.['min']">O valor mínimo é R$ 100,00.</span>
        </div>
      </div>
    </div>
    <div class="row pt-3">
      <div class="col-12 col-md-2 text-center text-md-start">
        <button type="submit" class="btn btn-primary">
          <i class="fa-solid fa-calculator"></i> Calcular
        </button>
      </div>
    </div>
  </form>
</div>

<div *ngIf="resultado && !resultado.erro" class="mt-5 animate__animated animate__fadeIn">

  <div class="row g-4">
    <div class="col-md-7">
      <div class="card border-0 shadow-sm h-100">
        <div class="card-body p-4">
          <h6 class="text-secondary text-uppercase fw-bold mb-4" style="letter-spacing: 1px;">Sua Capacidade de Crédito
          </h6>

          <div class="d-flex justify-content-between align-items-center mb-3 pb-3 border-bottom">
            <span class="text-muted fw-bold">Crédito Máximo</span>
            <span>{{ resultado.valorMaximoFinanciavel | currency:'BRL' }}</span>
          </div>

          <div class="d-flex justify-content-between align-items-center mb-3 pb-3 border-bottom">
            <span class="text-muted fw-bold">Prestação Mensal Estimada</span>
            <span>{{ resultado.prestacaoEstimada | currency:'BRL' }}</span>
          </div>
        </div>
      </div>
    </div>

    <div class="col-md-5">
      <div class="card border-0 bg-primary text-white shadow-sm h-100">
        <div class="card-body p-4">
          <h6 class="text-uppercase fw-bold mb-4" style="opacity: 0.8;">Condições:</h6>

          <div class="mb-4">
            <small class="d-block mb-1" style="opacity: 0.7;">Limite por Renda (30%)</small>
            <div class="h5 fw-bold">{{ resultado.prestacaoMaximaPermitida | currency:'BRL' }}</div>
          </div>

          <div class="row g-2">
            <div class="col-6">
              <small class="d-block mb-1" style="opacity: 0.7;">Taxa de Juros</small>
              <div class="fw-bold"> {{ resultado.taxaAplicadaAnual | percent:'1.2-4':'pt-BR' }} a.a</div>
            </div>
            <div class="col-6">
              <small class="d-block mb-1" style="opacity: 0.7;">Prazo Máximo</small>
              <div class="fw-bold">{{ resultado.prazoAplicadoAnos }} Anos</div>
            </div>
          </div>
          <div class="row p-3 mt-3 rounded bg-dark" *ngIf="permiteLiquidacaoSimultanea()">
            <div class="col-12 d-flex justify-content-center">
              <div class="form-check form-switch custom-switch" >
                <input class="form-check-input" type="checkbox" id="switchLiquidação"
                  [(ngModel)]="liquidacaoSimultanea" role="switch" (change)="calcular()">
                <label class="form-check-label fw-bold text-white ms-2" for="switchLiquidação" >
                    Liquidação Simultânea *
                </label>
              </div>
            </div>
          </div>
          <hr style="opacity: 0.3;">

          <div *ngIf="resultado.prestacaoEstimada >= resultado.prestacaoMaximaPermitida"
            class="mt-3 p-2 rounded bg-white text-warning dark small fw-bold shadow-sm">
            <i class="fa-solid fa-circle-info me-1"></i>
            Atenção: Margem de renda atingida no limite máximo.
          </div>
        </div>
      </div>
    </div>
  </div>


  <!-- Observações -->
  <div class="container pt-5">


    <!-- Observação 1 -->
    <div class="alert alert-info d-flex align-items-center" role="alert" id="obs1">
      <i class="fa-solid fa-circle-question me-2"></i>
      <div class="text-start m-3">Calculos baseados nas regras vigentes de Empréstimo com Garantia de Imóvel.<br>
        Comprometimento de renda máximo de 30% e financiamento limitado a 60% do valor do imóvel.
      </div>
    </div>

    <div *ngIf="permiteLiquidacaoSimultanea()" class="alert alert-info d-flex align-items-center" role="alert" id="obs1">
      <i class="fa-solid fa-circle-question me-2"></i>
      <div class="text-start m-3">O que é a Liquidação Simultânea?<br />
        A Liquidação Simultânea é a opção ideal para quem já possui um financiamento imobiliário em aberto, mas deseja
        contratar um novo crédito (EGI) utilizando o mesmo imóvel como garantia.
      </div>
    </div>
  </div>


</div>


<div *ngIf="resultado?.erro" class="mt-4 animate__animated animate__shakeX">
  <div class="alert alert-danger shadow-sm border-0 d-flex justify-content-center align-items-center py-3" role="alert">

    <div class="d-flex align-items-center">
      <i class="fa-solid fa-triangle-exclamation fs-4 me-3"></i>
      <div class="text-center text-md-start">
        <h6 class="alert-heading fw-bold mb-1 text-center">Atenção!</h6>
        <p class="mb-0">{{ resultado?.erro }}</p>
      </div>
    </div>

  </div>
</div>